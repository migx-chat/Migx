Context:
Aplikasi chat & feed real-time. Media (foto/video) disimpan di Cloudinary. Feed tidak disimpan ke database, hanya sementara dan harus auto delete setelah 1 jam agar app tetap ringan.
ğŸ¯ TUJUAN
Media tetap di Cloudinary
Metadata feed disimpan di Redis dengan TTL
Feed hilang otomatis dari aplikasi setelah TTL habis
TIDAK menghapus media Cloudinary otomatis
Aman untuk production, tidak merusak fitur lain
ğŸ”§ ARSITEKTUR WAJIB
Cloudinary â†’ media storage only
Redis â†’ feed metadata + TTL
Database â†’ TIDAK digunakan untuk feed
ğŸ“Œ IMPLEMENTASI YANG DIMINTA
1ï¸âƒ£ Saat user upload feed
Upload file ke Cloudinary
Ambil:
secure_url
public_id
Simpan ke Redis dengan TTL
Redis key pattern:
Salin kode

feed:<feedId>
Redis value (JSON):
Salin kode
Json
{
  "id": "feedId",
  "userId": "userId",
  "username": "username",
  "text": "caption text",
  "mediaUrl": "cloudinary secure_url",
  "mediaType": "image | video",
  "cloudinaryPublicId": "public_id",
  "createdAt": "ISO timestamp"
}
TTL:
Salin kode

3600 detik (1 jam)
Gunakan:
Salin kode
Js
SETEX feed:<feedId> 3600 <json>
2ï¸âƒ£ Endpoint ambil feed
Buat endpoint:
Salin kode

GET /api/feed
Logic:
Ambil semua key feed:* dari Redis
Parse JSON
Sort by createdAt DESC
Return ke client
âš ï¸ Jangan baca database
âš ï¸ Jangan simpan ke database
3ï¸âƒ£ Saat Redis key expired
Feed hilang otomatis
JANGAN auto delete Cloudinary
Media cleanup dilakukan terpisah (manual / batch)
4ï¸âƒ£ (Opsional tapi disiapkan)
Tambahkan fungsi admin cleanup Cloudinary:
Hanya dipanggil manual
Berdasarkan cloudinaryPublicId
Tidak otomatis saat TTL habis
âŒ LARANGAN KERAS
âŒ Jangan simpan feed ke PostgreSQL
âŒ Jangan simpan pesan feed ke Redis hash tanpa TTL
âŒ Jangan delete Cloudinary otomatis saat TTL
âŒ Jangan ubah logic chat / socket
âŒ Jangan refactor file lain di luar feed
âœ… HASIL YANG DIHARAPKAN
Feed ringan
Tidak menumpuk
App tidak berat setelah 1 jam
Real-time tetap cepat
Aman untuk Redis Cloud
Cocok untuk traffic tinggi
ğŸ“¦ CATATAN TAMBAHAN
Jika Redis restart:
Feed hilang (EXPECTED BEHAVIOR)
Tidak error
Media Cloudinary tetap aman